function buildHtmlTableByColIndex(sheetName, colIndexOneBased, keyValue) {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sh = ss.getSheetByName(sheetName);
  if (!sh) return ''; // sheet missing

  const lastCol = sh.getLastColumn();
  if (lastCol === 0) return '';
  const headerRow = sh.getRange(1, 1, 1, lastCol).getValues()[0];

  const lastRow = sh.getLastRow();
  if (lastRow < 2) return '';
  const data = sh.getRange(2, 1, lastRow - 1, lastCol).getValues();

  const colIndex0 = Math.max(0, colIndexOneBased - 1);
  const matches = data.filter(r => {
    const val = r[colIndex0];
    return (val !== null && val !== undefined && String(val).trim() === String(keyValue).trim());
  });
  if (matches.length === 0) return '';

  let tbl = '<p style="margin-top:12px;"><b>' + sheetName + ' - Matching rows for ID: ' + keyValue + '</b></p>';
  tbl += '<table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse; font-family:Arial; font-size:13px; width:100%;">';
  tbl += '<tr style="background:#FFFF00; font-weight:bold;">';

  for (let h = 0; h < headerRow.length; h++) {
    tbl += `<th style="padding:6px; border:1px solid #000; text-align:center;">${headerRow[h]||''}</th>`;
  }
  tbl += '</tr>';

  matches.forEach(row => {
    tbl += '<tr>';
    for (let c = 0; c < row.length; c++) {
      const cell = (row[c] === null || row[c] === undefined) ? '' : row[c];
      const align = (c === 0 || c === 1) ? 'left' : 'center';

      // â— RAW numbers only for Sheet3
      let disp;
      if (sheetName === CONFIG_ADDITIONAL.sheet3Name) {
        disp = cell; // no percentage formatting
      } else {
        disp = (typeof cell === 'number') ? formatPercent(cell) : cell;
      }

      tbl += `<td style="padding:6px; border:1px solid #000; text-align:${align};">${disp}</td>`;
    }
    tbl += '</tr>';
  });

  tbl += '</table>';
  return tbl;
}
